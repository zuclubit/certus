<mxfile host="app.diagrams.net" modified="2025-11-21T17:00:00.000Z" agent="Claude Code - Improved Version" version="24.0.0">
  <diagram name="Arquitectura Hergon - Mejorado" id="arquitectura-hergon-v2">
    <mxGraphModel dx="2400" dy="1600" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="2800" pageHeight="2400" math="0" shadow="0" background="#ffffff">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />

        <!-- FONDO BLANCO -->
        <mxCell id="background" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=none;" vertex="1" parent="1">
          <mxGeometry width="2800" height="2400" as="geometry" />
        </mxCell>

        <!-- ========== TÃTULO ========== -->
        <mxCell id="titulo-principal" value="ARQUITECTURA TÃ‰CNICA COMPLETA - HERGON VECTOR01" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=28;fontStyle=1;fontColor=#1a1a1a" vertex="1" parent="1">
          <mxGeometry x="700" y="30" width="1400" height="50" as="geometry" />
        </mxCell>

        <mxCell id="subtitulo" value="Sistema de ValidaciÃ³n de Archivos Regulatorios CONSAR" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=18;fontStyle=0;fontColor=#666666" vertex="1" parent="1">
          <mxGeometry x="700" y="85" width="1400" height="30" as="geometry" />
        </mxCell>

        <!-- ========== CAPA 1: SISTEMAS EXTERNOS (ORIGEN) ========== -->
        <mxCell id="capa1-bg" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e8f5e9;strokeColor=#4caf50;strokeWidth=3;opacity=30" vertex="1" parent="1">
          <mxGeometry x="80" y="150" width="2640" height="320" as="geometry" />
        </mxCell>

        <mxCell id="capa1-titulo" value="CAPA 1: SISTEMAS EXTERNOS (ORIGEN DE DATOS)" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=20;fontStyle=1;fontColor=#2e7d32" vertex="1" parent="1">
          <mxGeometry x="110" y="165" width="600" height="35" as="geometry" />
        </mxCell>

        <!-- Sistema de Precios -->
        <mxCell id="sistema-precios" value="&lt;b style=&quot;font-size:16px&quot;&gt;Sistema de Precios&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#66bb6a;strokeColor=#2e7d32;strokeWidth=2;fontColor=#ffffff;fontSize=13;spacingTop=10;spacingBottom=10;spacingLeft=15;spacingRight=15;align=center" vertex="1" parent="1">
          <mxGeometry x="120" y="220" width="240" height="80" as="geometry" />
        </mxCell>
        <mxCell id="precios-detalle" value="â€¢ Precios de valores&#xa;â€¢ Tipos de cambio&#xa;â€¢ ValuaciÃ³n diaria" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;fontColor=#ffffff" vertex="1" parent="1">
          <mxGeometry x="130" y="310" width="220" height="140" as="geometry" />
        </mxCell>

        <!-- SAP ERP -->
        <mxCell id="sap-header" value="&lt;b style=&quot;font-size:16px&quot;&gt;SAP ERP (AFORE)&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#66bb6a;strokeColor=#2e7d32;strokeWidth=2;fontColor=#ffffff;fontSize=13;spacingTop=10;spacingBottom=10;spacingLeft=15;spacingRight=15" vertex="1" parent="1">
          <mxGeometry x="400" y="220" width="260" height="80" as="geometry" />
        </mxCell>
        <mxCell id="sap-detalle" value="â€¢ Balanza de comprobaciÃ³n&#xa;â€¢ Cuentas contables&#xa;â€¢ Auxiliares contables&#xa;&#xa;&lt;b&gt;Conector:&lt;/b&gt; RFC/BAPI" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;fontColor=#ffffff" vertex="1" parent="1">
          <mxGeometry x="410" y="310" width="240" height="140" as="geometry" />
        </mxCell>

        <!-- Oracle ERP -->
        <mxCell id="oracle-header" value="&lt;b style=&quot;font-size:16px&quot;&gt;Oracle ERP (AFORE)&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#66bb6a;strokeColor=#2e7d32;strokeWidth=2;fontColor=#ffffff;fontSize=13;spacingTop=10;spacingBottom=10;spacingLeft=15;spacingRight=15" vertex="1" parent="1">
          <mxGeometry x="700" y="220" width="260" height="80" as="geometry" />
        </mxCell>
        <mxCell id="oracle-detalle" value="â€¢ General Ledger&#xa;â€¢ Sub-ledgers&#xa;â€¢ Reportes financieros&#xa;&#xa;&lt;b&gt;Conector:&lt;/b&gt; DB Link/OData" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;fontColor=#ffffff" vertex="1" parent="1">
          <mxGeometry x="710" y="310" width="240" height="140" as="geometry" />
        </mxCell>

        <!-- Aladdin -->
        <mxCell id="aladdin-header" value="&lt;b style=&quot;font-size:16px&quot;&gt;Aladdin API&lt;/b&gt;&#xa;(BlackRock)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#212121;strokeColor=#000000;strokeWidth=2;fontColor=#ffffff;fontSize=13;spacingTop=10;spacingBottom=10;spacingLeft=15;spacingRight=15" vertex="1" parent="1">
          <mxGeometry x="1000" y="220" width="260" height="80" as="geometry" />
        </mxCell>
        <mxCell id="aladdin-detalle" value="â€¢ Posiciones de portafolio&#xa;â€¢ ValuaciÃ³n de activos&#xa;â€¢ Risk metrics&#xa;&#xa;&lt;b&gt;Protocolo:&lt;/b&gt; REST API&#xa;&lt;b&gt;Auth:&lt;/b&gt; OAuth 2.0" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;fontColor=#ffffff" vertex="1" parent="1">
          <mxGeometry x="1010" y="310" width="240" height="140" as="geometry" />
        </mxCell>

        <!-- SFTP Inbound -->
        <mxCell id="sftp-in-header" value="&lt;b style=&quot;font-size:16px&quot;&gt;SFTP Server&lt;/b&gt;&#xa;(Inbound)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#66bb6a;strokeColor=#2e7d32;strokeWidth=2;fontColor=#ffffff;fontSize=13;spacingTop=10;spacingBottom=10;spacingLeft=15;spacingRight=15" vertex="1" parent="1">
          <mxGeometry x="1300" y="220" width="260" height="80" as="geometry" />
        </mxCell>
        <mxCell id="sftp-in-detalle" value="â€¢ RecepciÃ³n de archivos&#xa;â€¢ Upload manual AFOREs&#xa;â€¢ Polling automÃ¡tico&#xa;&#xa;&lt;b&gt;Protocolo:&lt;/b&gt; SFTP/TLS 1.3" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;fontColor=#ffffff" vertex="1" parent="1">
          <mxGeometry x="1310" y="310" width="240" height="140" as="geometry" />
        </mxCell>

        <!-- Sistemas GenÃ©ricos -->
        <mxCell id="genericos-header" value="&lt;b style=&quot;font-size:16px&quot;&gt;Sistemas Contables&lt;/b&gt;&#xa;(GenÃ©ricos)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#66bb6a;strokeColor=#2e7d32;strokeWidth=2;fontColor=#ffffff;fontSize=13;spacingTop=10;spacingBottom=10;spacingLeft=15;spacingRight=15" vertex="1" parent="1">
          <mxGeometry x="1600" y="220" width="260" height="80" as="geometry" />
        </mxCell>
        <mxCell id="genericos-detalle" value="â€¢ CSV/Excel&#xa;â€¢ Archivos posicionales&#xa;â€¢ APIs REST custom&#xa;&#xa;&lt;b&gt;Conector:&lt;/b&gt; Generic Parser" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;fontColor=#ffffff" vertex="1" parent="1">
          <mxGeometry x="1610" y="310" width="240" height="140" as="geometry" />
        </mxCell>

        <!-- Usuarios Web -->
        <mxCell id="usuarios-header" value="&lt;b style=&quot;font-size:16px&quot;&gt;Usuarios Web&lt;/b&gt;&#xa;(Portal)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#42a5f5;strokeColor=#1565c0;strokeWidth=2;fontColor=#ffffff;fontSize=13;spacingTop=10;spacingBottom=10;spacingLeft=15;spacingRight=15" vertex="1" parent="1">
          <mxGeometry x="1900" y="220" width="260" height="80" as="geometry" />
        </mxCell>
        <mxCell id="usuarios-detalle" value="â€¢ Upload manual&#xa;â€¢ Consulta resultados&#xa;â€¢ CorrecciÃ³n archivos&#xa;&#xa;&lt;b&gt;Auth:&lt;/b&gt; Azure AD B2C" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;fontColor=#ffffff" vertex="1" parent="1">
          <mxGeometry x="1910" y="310" width="240" height="140" as="geometry" />
        </mxCell>

        <!-- ========== CAPA 2: SEGURIDAD E INTEGRACIÃ“N ========== -->
        <mxCell id="capa2-bg" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff3e0;strokeColor=#ef6c00;strokeWidth=3;opacity=30" vertex="1" parent="1">
          <mxGeometry x="80" y="550" width="2640" height="450" as="geometry" />
        </mxCell>

        <mxCell id="capa2-titulo" value="CAPA 2: SEGURIDAD E INTEGRACIÃ“N" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=20;fontStyle=1;fontColor=#e65100" vertex="1" parent="1">
          <mxGeometry x="110" y="565" width="500" height="35" as="geometry" />
        </mxCell>

        <!-- API Gateway -->
        <mxCell id="api-gateway-box" value="&lt;b style=&quot;font-size:16px&quot;&gt;API GATEWAY&lt;/b&gt;&#xa;(M2M Authentication)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ce93d8;strokeColor=#7b1fa2;strokeWidth=2;fontColor=#4a148c;fontSize=13;spacingTop=15;spacingBottom=15;spacingLeft=20;spacingRight=20;align=center" vertex="1" parent="1">
          <mxGeometry x="120" y="620" width="320" height="90" as="geometry" />
        </mxCell>
        <mxCell id="api-gateway-detalle" value="â€¢ OAuth 2.0 Client Credentials&#xa;â€¢ API Key validation&#xa;â€¢ Rate limiting per source&#xa;â€¢ Request/Response logging&#xa;â€¢ JWT validation&#xa;&#xa;&lt;b&gt;Tech:&lt;/b&gt; Azure API Management&#xa;          AWS API Gateway" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=12;fontColor=#4a148c" vertex="1" parent="1">
          <mxGeometry x="130" y="720" width="300" height="250" as="geometry" />
        </mxCell>

        <!-- Integration Service / ETL HUB - COMPONENTE CRÃTICO -->
        <mxCell id="etl-box" value="&lt;b style=&quot;font-size:18px&quot;&gt;INTEGRATION SERVICE / ETL HUB&lt;/b&gt;&#xa;âš ï¸ COMPONENTE CRÃTICO" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#90caf9;strokeColor=#1565c0;strokeWidth=3;fontColor=#0d47a1;fontSize=14;spacingTop=15;spacingBottom=15;spacingLeft=20;spacingRight=20;align=center" vertex="1" parent="1">
          <mxGeometry x="480" y="620" width="580" height="90" as="geometry" />
        </mxCell>
        <mxCell id="etl-extract" value="&lt;b style=&quot;font-size:14px&quot;&gt;ðŸ“¥ EXTRACT&lt;/b&gt;&#xa;â€¢ Pull data from sources (API/SFTP/DB)&#xa;â€¢ Schedule-based or event-driven&#xa;â€¢ Error handling &amp; retry logic" style="text;html=1;strokeColor=#1565c0;fillColor=#e3f2fd;align=left;verticalAlign=top;whiteSpace=wrap;rounded=1;fontSize=12;fontColor=#0d47a1;strokeWidth=1;spacingTop=8;spacingLeft=10;spacingRight=10;spacingBottom=8" vertex="1" parent="1">
          <mxGeometry x="490" y="720" width="270" height="90" as="geometry" />
        </mxCell>
        <mxCell id="etl-transform" value="&lt;b style=&quot;font-size:14px&quot;&gt;ðŸ”„ TRANSFORM&lt;/b&gt;&#xa;â€¢ Map source â†’ CONSAR format&#xa;â€¢ Data validation (pre-load)&#xa;â€¢ Business rules application&#xa;â€¢ Type conversions" style="text;html=1;strokeColor=#1565c0;fillColor=#e3f2fd;align=left;verticalAlign=top;whiteSpace=wrap;rounded=1;fontSize=12;fontColor=#0d47a1;strokeWidth=1;spacingTop=8;spacingLeft=10;spacingRight=10;spacingBottom=8" vertex="1" parent="1">
          <mxGeometry x="780" y="720" width="270" height="90" as="geometry" />
        </mxCell>
        <mxCell id="etl-load" value="&lt;b style=&quot;font-size:14px&quot;&gt;ðŸ“¤ LOAD&lt;/b&gt;&#xa;â€¢ Bulk insert to Sistema Contable&#xa;â€¢ Transaction management&#xa;â€¢ Rollback on errors" style="text;html=1;strokeColor=#1565c0;fillColor=#e3f2fd;align=left;verticalAlign=top;whiteSpace=wrap;rounded=1;fontSize=12;fontColor=#0d47a1;strokeWidth=1;spacingTop=8;spacingLeft=10;spacingRight=10;spacingBottom=8" vertex="1" parent="1">
          <mxGeometry x="490" y="825" width="270" height="80" as="geometry" />
        </mxCell>
        <mxCell id="etl-connectors" value="&lt;b style=&quot;font-size:14px&quot;&gt;ðŸ”Œ CONNECTORS&lt;/b&gt;&#xa;â”œâ”€ SAP (RFC/BAPI)&#xa;â”œâ”€ Oracle (DB Link/OData)&#xa;â”œâ”€ Aladdin (REST + OAuth 2.0)&#xa;â”œâ”€ SFTP (polling)&#xa;â””â”€ Generic Parser (CSV/Excel)" style="text;html=1;strokeColor=#1565c0;fillColor=#e3f2fd;align=left;verticalAlign=top;whiteSpace=wrap;rounded=1;fontSize=12;fontColor=#0d47a1;strokeWidth=1;spacingTop=8;spacingLeft=10;spacingRight=10;spacingBottom=8;fontFamily=Courier New" vertex="1" parent="1">
          <mxGeometry x="780" y="825" width="270" height="130" as="geometry" />
        </mxCell>
        <mxCell id="etl-tech" value="&lt;b&gt;Tech:&lt;/b&gt; .NET 8 Worker Service&#xa;         Azure Data Factory / AWS Glue&#xa;&lt;b&gt;Deploy:&lt;/b&gt; Container Apps / ECS Fargate" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=11;fontColor=#0d47a1;fontFamily=Consolas" vertex="1" parent="1">
          <mxGeometry x="490" y="920" width="350" height="70" as="geometry" />
        </mxCell>

        <!-- Azure AD -->
        <mxCell id="azuread-box" value="&lt;b style=&quot;font-size:16px&quot;&gt;AZURE AD B2C&lt;/b&gt;&#xa;/ AWS Cognito" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ce93d8;strokeColor=#7b1fa2;strokeWidth=2;fontColor=#4a148c;fontSize=13;spacingTop=15;spacingBottom=15;spacingLeft=20;spacingRight=20" vertex="1" parent="1">
          <mxGeometry x="1100" y="620" width="280" height="90" as="geometry" />
        </mxCell>
        <mxCell id="azuread-detalle" value="â€¢ OAuth 2.0 / OIDC&#xa;â€¢ Multi-Factor Auth (MFA)&#xa;â€¢ Conditional Access&#xa;â€¢ B2B Collaboration&#xa;&#xa;&lt;b&gt;Claims:&lt;/b&gt;&#xa;  - aforeId, fondoIds[]&#xa;  - role, country" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=12;fontColor=#4a148c" vertex="1" parent="1">
          <mxGeometry x="1110" y="720" width="260" height="250" as="geometry" />
        </mxCell>

        <!-- Secrets Manager -->
        <mxCell id="secrets-box" value="&lt;b style=&quot;font-size:16px&quot;&gt;SECRETS MANAGER&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ce93d8;strokeColor=#7b1fa2;strokeWidth=2;fontColor=#4a148c;fontSize=13;spacingTop=15;spacingBottom=15;spacingLeft=20;spacingRight=20" vertex="1" parent="1">
          <mxGeometry x="1420" y="620" width="280" height="90" as="geometry" />
        </mxCell>
        <mxCell id="secrets-detalle" value="â€¢ API Keys (Aladdin, etc)&#xa;â€¢ PGP Keys (CONSAR)&#xa;â€¢ DB Credentials&#xa;â€¢ Certificates (SSL/TLS)&#xa;â€¢ Auto-rotation (90 days)&#xa;&#xa;&lt;b&gt;Tech:&lt;/b&gt; Azure Key Vault&#xa;          AWS Secrets Manager" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=12;fontColor=#4a148c" vertex="1" parent="1">
          <mxGeometry x="1430" y="720" width="260" height="250" as="geometry" />
        </mxCell>

        <!-- Service Bus -->
        <mxCell id="bus-box" value="&lt;b style=&quot;font-size:16px&quot;&gt;MESSAGE QUEUE&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff9c4;strokeColor=#f57f17;strokeWidth=2;fontColor=#f57f17;fontSize=13;spacingTop=15;spacingBottom=15;spacingLeft=20;spacingRight=20" vertex="1" parent="1">
          <mxGeometry x="1740" y="620" width="280" height="90" as="geometry" />
        </mxCell>
        <mxCell id="bus-detalle" value="&lt;b&gt;Topics:&lt;/b&gt;&#xa;â€¢ file-events&#xa;â€¢ validation-events&#xa;â€¢ integration-events&#xa;&#xa;&lt;b&gt;Queues:&lt;/b&gt;&#xa;â€¢ validation-queue&#xa;â€¢ report-queue&#xa;â€¢ dlq (dead-letter)&#xa;&#xa;&lt;b&gt;Tech:&lt;/b&gt; Service Bus / SQS+SNS" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=12;fontColor=#f57f17" vertex="1" parent="1">
          <mxGeometry x="1750" y="720" width="260" height="250" as="geometry" />
        </mxCell>

        <!-- Monitoring -->
        <mxCell id="monitor-box" value="&lt;b style=&quot;font-size:16px&quot;&gt;MONITORING&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ce93d8;strokeColor=#7b1fa2;strokeWidth=2;fontColor=#4a148c;fontSize=13;spacingTop=15;spacingBottom=15;spacingLeft=20;spacingRight=20" vertex="1" parent="1">
          <mxGeometry x="2060" y="620" width="280" height="90" as="geometry" />
        </mxCell>
        <mxCell id="monitor-detalle" value="â€¢ Health checks&#xa;â€¢ Custom metrics&#xa;â€¢ Distributed tracing&#xa;â€¢ Alerts (email/SMS)&#xa;â€¢ Dashboards&#xa;&#xa;&lt;b&gt;Tech:&lt;/b&gt; App Insights&#xa;          CloudWatch" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=12;fontColor=#4a148c" vertex="1" parent="1">
          <mxGeometry x="2070" y="720" width="260" height="250" as="geometry" />
        </mxCell>

        <!-- ========== CAPA 3: CORE SYSTEM ========== -->
        <mxCell id="capa3-bg" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e3f2fd;strokeColor=#1565c0;strokeWidth=3;opacity=30" vertex="1" parent="1">
          <mxGeometry x="80" y="1080" width="2640" height="520" as="geometry" />
        </mxCell>

        <mxCell id="capa3-titulo" value="CAPA 3: CORE SYSTEM HERGON" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=20;fontStyle=1;fontColor=#0d47a1" vertex="1" parent="1">
          <mxGeometry x="110" y="1095" width="400" height="35" as="geometry" />
        </mxCell>

        <!-- Parser Service -->
        <mxCell id="parser-box" value="&lt;b style=&quot;font-size:16px&quot;&gt;PARSER SERVICE&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#1976d2;strokeColor=#0d47a1;strokeWidth=2;fontColor=#ffffff;fontSize=13;spacingTop=15;spacingBottom=15;spacingLeft=20;spacingRight=20" vertex="1" parent="1">
          <mxGeometry x="120" y="1150" width="340" height="80" as="geometry" />
        </mxCell>
        <mxCell id="parser-detalle" value="â€¢ Parse fixed-width (77 chars)&#xa;â€¢ Extract encabezado + detalle&#xa;â€¢ Identify file type:&#xa;  - 1101: Balanza ComprobaciÃ³n&#xa;  - 1102: Cuentas de Orden&#xa;  - 1103: Posiciones Extranjero&#xa;  - 1104: Cuentas Individuales&#xa;â€¢ Validate basic structure&#xa;&#xa;&lt;b&gt;Tech:&lt;/b&gt; Azure Function / Lambda&#xa;&lt;b&gt;Trigger:&lt;/b&gt; Service Bus / SQS" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=12;fontColor=#ffffff" vertex="1" parent="1">
          <mxGeometry x="130" y="1240" width="320" height="330" as="geometry" />
        </mxCell>

        <!-- Sistema Contable -->
        <mxCell id="contable-box" value="&lt;b style=&quot;font-size:16px&quot;&gt;SISTEMA CONTABLE&lt;/b&gt;&#xa;(Write Model)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#1976d2;strokeColor=#0d47a1;strokeWidth=2;fontColor=#ffffff;fontSize=13;spacingTop=15;spacingBottom=15;spacingLeft=20;spacingRight=20" vertex="1" parent="1">
          <mxGeometry x="500" y="1150" width="340" height="80" as="geometry" />
        </mxCell>
        <mxCell id="contable-detalle" value="â€¢ Store parsed records&#xa;â€¢ Catalog data&#xa;  (cuentas, divisas, tipos cambio)&#xa;â€¢ File metadata&#xa;â€¢ Processing status&#xa;&#xa;&lt;b&gt;Database:&lt;/b&gt; Azure SQL / RDS&#xa;  - CatalogDB (4 vCore)&#xa;  - FileRecordsDB (4 vCore)&#xa;  - Zone redundant&#xa;&#xa;&lt;b&gt;Features:&lt;/b&gt;&#xa;â€¢ Row-Level Security (RLS)&#xa;â€¢ Multi-tenant isolation&#xa;â€¢ Optimized indexes" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=12;fontColor=#ffffff" vertex="1" parent="1">
          <mxGeometry x="510" y="1240" width="320" height="330" as="geometry" />
        </mxCell>

        <!-- Sistema ValidaciÃ³n - CRÃTICO -->
        <mxCell id="validacion-box" value="&lt;b style=&quot;font-size:18px&quot;&gt;SISTEMA VALIDACIÃ“N&lt;/b&gt;&#xa;âš ï¸ 37 Validaciones CONSAR" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#1976d2;strokeColor=#0d47a1;strokeWidth=3;fontColor=#ffffff;fontSize=14;spacingTop=15;spacingBottom=15;spacingLeft=20;spacingRight=20" vertex="1" parent="1">
          <mxGeometry x="880" y="1150" width="520" height="80" as="geometry" />
        </mxCell>
        <mxCell id="validacion-orchestrator" value="&lt;b style=&quot;font-size:14px&quot;&gt;Validation Orchestrator&lt;/b&gt;&#xa;â€¢ Trigger 37 validators in parallel&#xa;â€¢ Monitor execution status&#xa;â€¢ Aggregate results&#xa;â€¢ Generate report" style="text;html=1;strokeColor=#0d47a1;fillColor=#bbdefb;align=left;verticalAlign=top;whiteSpace=wrap;rounded=1;fontSize=12;fontColor=#0d47a1;strokeWidth=1;spacingTop=8;spacingLeft=10;spacingRight=10;spacingBottom=8" vertex="1" parent="1">
          <mxGeometry x="890" y="1240" width="240" height="100" as="geometry" />
        </mxCell>
        <mxCell id="validacion-validators" value="&lt;b style=&quot;font-size:14px&quot;&gt;37 Validators (parallel)&lt;/b&gt;&#xa;V01-V08: Longitud, Tipo Dato&#xa;V09-V15: Montos, Naturaleza&#xa;V16-V25: Contracuentas&#xa;V26-V33: Divisas vs Pesos&#xa;V34-V37: Balanza, Integridad" style="text;html=1;strokeColor=#0d47a1;fillColor=#bbdefb;align=left;verticalAlign=top;whiteSpace=wrap;rounded=1;fontSize=12;fontColor=#0d47a1;strokeWidth=1;spacingTop=8;spacingLeft=10;spacingRight=10;spacingBottom=8" vertex="1" parent="1">
          <mxGeometry x="1150" y="1240" width="240" height="120" as="geometry" />
        </mxCell>
        <mxCell id="validacion-aggregator" value="&lt;b style=&quot;font-size:14px&quot;&gt;Results Aggregator&lt;/b&gt;&#xa;â€¢ Consolidate 37 results&#xa;â€¢ Pass/fail summary&#xa;â€¢ Generate PDF/Excel&#xa;â€¢ Update file status" style="text;html=1;strokeColor=#0d47a1;fillColor=#bbdefb;align=left;verticalAlign=top;whiteSpace=wrap;rounded=1;fontSize=12;fontColor=#0d47a1;strokeWidth=1;spacingTop=8;spacingLeft=10;spacingRight=10;spacingBottom=8" vertex="1" parent="1">
          <mxGeometry x="890" y="1355" width="240" height="100" as="geometry" />
        </mxCell>
        <mxCell id="validacion-tech" value="&lt;b&gt;Tech:&lt;/b&gt; .NET 8 Functions&#xa;  â€¢ 10 Premium (always-on)&#xa;  â€¢ 27 Consumption (on-demand)&#xa;  â€¢ AWS Lambda (Graviton4 ARM64)&#xa;&#xa;&lt;b&gt;Storage:&lt;/b&gt; SQL DB + Blob/S3" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=11;fontColor=#ffffff;fontFamily=Consolas" vertex="1" parent="1">
          <mxGeometry x="1150" y="1375" width="240" height="180" as="geometry" />
        </mxCell>

        <!-- Correcciones -->
        <mxCell id="correccion-manual-box" value="&lt;b style=&quot;font-size:15px&quot;&gt;CORRECCIÃ“N&lt;/b&gt;&#xa;&lt;b style=&quot;font-size:15px&quot;&gt;MANUAL&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffcdd2;strokeColor=#c62828;strokeWidth=2;fontColor=#b71c1c;fontSize=13;spacingTop=15;spacingBottom=15;spacingLeft=20;spacingRight=20" vertex="1" parent="1">
          <mxGeometry x="1440" y="1150" width="200" height="100" as="geometry" />
        </mxCell>
        <mxCell id="correccion-manual-detalle" value="Usuario edita&#xa;archivo en&#xa;portal web&#xa;&#xa;â†’ Re-validaciÃ³n" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;fontColor=#b71c1c" vertex="1" parent="1">
          <mxGeometry x="1450" y="1260" width="180" height="120" as="geometry" />
        </mxCell>

        <mxCell id="correccion-raiz-box" value="&lt;b style=&quot;font-size:15px&quot;&gt;CORRECCIÃ“N&lt;/b&gt;&#xa;&lt;b style=&quot;font-size:15px&quot;&gt;DE RAÃZ&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffcdd2;strokeColor=#c62828;strokeWidth=2;fontColor=#b71c1c;fontSize=13;spacingTop=15;spacingBottom=15;spacingLeft=20;spacingRight=20" vertex="1" parent="1">
          <mxGeometry x="1440" y="1400" width="200" height="100" as="geometry" />
        </mxCell>
        <mxCell id="correccion-raiz-detalle" value="Fix en sistema&#xa;origen (Aladdin,&#xa;SAP, Oracle)&#xa;&#xa;â†’ Re-extracciÃ³n" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;fontColor=#b71c1c" vertex="1" parent="1">
          <mxGeometry x="1450" y="1510" width="180" height="80" as="geometry" />
        </mxCell>

        <!-- SFTP Gateway - CRÃTICO -->
        <mxCell id="sftp-gateway-box" value="&lt;b style=&quot;font-size:18px&quot;&gt;SFTP GATEWAY&lt;/b&gt;&#xa;âš ï¸ to CONSAR (PGP)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#66bb6a;strokeColor=#2e7d32;strokeWidth=3;fontColor=#ffffff;fontSize=14;spacingTop=15;spacingBottom=15;spacingLeft=20;spacingRight=20" vertex="1" parent="1">
          <mxGeometry x="1680" y="1150" width="340" height="80" as="geometry" />
        </mxCell>
        <mxCell id="sftp-gateway-detalle" value="&lt;b style=&quot;font-size:14px&quot;&gt;Process:&lt;/b&gt;&#xa;1. Encrypt with PGP&#xa;   (CONSAR public key)&#xa;2. SFTP connection (TLS 1.3)&#xa;3. Upload encrypted file&#xa;4. Wait acknowledgment&#xa;5. Store proof&#xa;6. Notify user (email/SMS)&#xa;&#xa;&lt;b&gt;PGP Encryption:&lt;/b&gt;&#xa;â€¢ Public key from CONSAR&#xa;â€¢ Private key in Key Vault&#xa;&#xa;&lt;b&gt;Tech:&lt;/b&gt; Azure FTP Service&#xa;         AWS Transfer Family" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=12;fontColor=#ffffff" vertex="1" parent="1">
          <mxGeometry x="1690" y="1240" width="320" height="330" as="geometry" />
        </mxCell>

        <!-- Reports & Notifications -->
        <mxCell id="reports-box" value="&lt;b style=&quot;font-size:15px&quot;&gt;REPORT GENERATOR&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#1976d2;strokeColor=#0d47a1;strokeWidth=2;fontColor=#ffffff;fontSize=13;spacingTop=10;spacingBottom=10;spacingLeft=15;spacingRight=15" vertex="1" parent="1">
          <mxGeometry x="2060" y="1150" width="280" height="70" as="geometry" />
        </mxCell>
        <mxCell id="reports-detalle" value="â€¢ PDF Reports (QuestPDF)&#xa;â€¢ Excel Reports&#xa;â€¢ Summary dashboard&#xa;â€¢ Error details&#xa;&#xa;&lt;b&gt;Storage:&lt;/b&gt; Blob / S3" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=12;fontColor=#ffffff" vertex="1" parent="1">
          <mxGeometry x="2070" y="1230" width="260" height="140" as="geometry" />
        </mxCell>

        <mxCell id="notifications-box" value="&lt;b style=&quot;font-size:15px&quot;&gt;NOTIFICATION SERVICE&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#1976d2;strokeColor=#0d47a1;strokeWidth=2;fontColor=#ffffff;fontSize=13;spacingTop=10;spacingBottom=10;spacingLeft=15;spacingRight=15" vertex="1" parent="1">
          <mxGeometry x="2060" y="1390" width="280" height="70" as="geometry" />
        </mxCell>
        <mxCell id="notifications-detalle" value="â€¢ Email (SES/SendGrid)&#xa;â€¢ SMS (SNS/Twilio)&#xa;â€¢ Webhooks&#xa;â€¢ Push notifications&#xa;&#xa;&lt;b&gt;Templates:&lt;/b&gt; Markdown" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=12;fontColor=#ffffff" vertex="1" parent="1">
          <mxGeometry x="2070" y="1470" width="260" height="130" as="geometry" />
        </mxCell>

        <!-- ========== CAPA 4: CONSAR ========== -->
        <mxCell id="capa4-bg" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e8f5e9;strokeColor=#4caf50;strokeWidth=3;opacity=30" vertex="1" parent="1">
          <mxGeometry x="80" y="1680" width="2640" height="200" as="geometry" />
        </mxCell>

        <mxCell id="capa4-titulo" value="SISTEMA EXTERNO (DESTINO)" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=20;fontStyle=1;fontColor=#2e7d32" vertex="1" parent="1">
          <mxGeometry x="110" y="1695" width="400" height="35" as="geometry" />
        </mxCell>

        <!-- CONSAR -->
        <mxCell id="consar-box" value="&lt;b style=&quot;font-size:18px&quot;&gt;CONSAR - ComisiÃ³n Nacional del Sistema de Ahorro para el Retiro&lt;/b&gt;&#xa;(AUTORIDAD REGULATORIA)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#66bb6a;strokeColor=#2e7d32;strokeWidth=3;fontColor=#ffffff;fontSize=15;spacingTop=15;spacingBottom=15;spacingLeft=30;spacingRight=30" vertex="1" parent="1">
          <mxGeometry x="400" y="1750" width="1600" height="80" as="geometry" />
        </mxCell>
        <mxCell id="consar-detalle" value="â€¢ SFTP Server  â€¢ RecepciÃ³n archivos encriptados (PGP)  â€¢ ValidaciÃ³n formato nombre  â€¢ ConfirmaciÃ³n de recepciÃ³n&#xa;&#xa;&lt;b&gt;Protocolo:&lt;/b&gt; SFTP + TLS 1.3  |  &lt;b&gt;EncriptaciÃ³n:&lt;/b&gt; PGP con clave pÃºblica CONSAR  |  &lt;b&gt;Formato:&lt;/b&gt; YYYYMMDD_XX_AAA_FFFFFF.TTSS" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;fontColor=#ffffff" vertex="1" parent="1">
          <mxGeometry x="410" y="1840" width="1580" height="30" as="geometry" />
        </mxCell>

        <!-- ========== CONEXIONES ========== -->

        <!-- Capa 1 â†’ Capa 2 -->
        <mxCell id="conn1" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#4caf50;strokeWidth=3;endArrow=classic;endFill=1" edge="1" parent="1" source="sistema-precios" target="api-gateway-box">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="label1" value="REST API" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=11;fontColor=#2e7d32;fontStyle=1;backgroundColor=#ffffff;labelBackgroundColor=#ffffff;labelBorderColor=#4caf50" vertex="1" connectable="0" parent="conn1">
          <mxGeometry x="-0.2" y="2" relative="1" as="geometry"><mxPoint x="2" y="-10" as="offset" /></mxGeometry>
        </mxCell>

        <mxCell id="conn2" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#4caf50;strokeWidth=3;endArrow=classic;endFill=1" edge="1" parent="1" source="sap-header" target="etl-box">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="label2" value="RFC/BAPI" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=11;fontColor=#2e7d32;fontStyle=1;backgroundColor=#ffffff;labelBackgroundColor=#ffffff;labelBorderColor=#4caf50" vertex="1" connectable="0" parent="conn2">
          <mxGeometry x="-0.2" y="2" relative="1" as="geometry"><mxPoint x="2" y="-10" as="offset" /></mxGeometry>
        </mxCell>

        <mxCell id="conn3" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#4caf50;strokeWidth=3;endArrow=classic;endFill=1" edge="1" parent="1" source="oracle-header" target="etl-box">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="label3" value="DB Link/OData" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=11;fontColor=#2e7d32;fontStyle=1;backgroundColor=#ffffff;labelBackgroundColor=#ffffff;labelBorderColor=#4caf50" vertex="1" connectable="0" parent="conn3">
          <mxGeometry x="-0.2" y="2" relative="1" as="geometry"><mxPoint x="2" y="-10" as="offset" /></mxGeometry>
        </mxCell>

        <mxCell id="conn4" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#000000;strokeWidth=3;endArrow=classic;endFill=1" edge="1" parent="1" source="aladdin-header" target="etl-box">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="label4" value="REST API + OAuth 2.0" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=11;fontColor=#000000;fontStyle=1;backgroundColor=#ffffff;labelBackgroundColor=#ffffff;labelBorderColor=#000000" vertex="1" connectable="0" parent="conn4">
          <mxGeometry x="-0.2" y="2" relative="1" as="geometry"><mxPoint x="2" y="-10" as="offset" /></mxGeometry>
        </mxCell>

        <mxCell id="conn5" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#4caf50;strokeWidth=3;endArrow=classic;endFill=1" edge="1" parent="1" source="sftp-in-header" target="etl-box">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="conn6" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#4caf50;strokeWidth=3;endArrow=classic;endFill=1" edge="1" parent="1" source="genericos-header" target="etl-box">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="conn7" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#1565c0;strokeWidth=3;endArrow=classic;endFill=1" edge="1" parent="1" source="usuarios-header" target="azuread-box">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="label7" value="OAuth 2.0 / OIDC" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=11;fontColor=#1565c0;fontStyle=1;backgroundColor=#ffffff;labelBackgroundColor=#ffffff;labelBorderColor=#1565c0" vertex="1" connectable="0" parent="conn7">
          <mxGeometry x="-0.2" y="2" relative="1" as="geometry"><mxPoint x="2" y="-10" as="offset" /></mxGeometry>
        </mxCell>

        <!-- Capa 2 â†’ Capa 3 -->
        <mxCell id="conn8" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#1565c0;strokeWidth=4;endArrow=classic;endFill=1" edge="1" parent="1" source="etl-box" target="parser-box">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="label8" value="Transformed Data (CONSAR Format)" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=12;fontColor=#0d47a1;fontStyle=1;backgroundColor=#ffffff;labelBackgroundColor=#ffffff;labelBorderColor=#1565c0" vertex="1" connectable="0" parent="conn8">
          <mxGeometry x="-0.2" y="2" relative="1" as="geometry"><mxPoint x="2" y="-12" as="offset" /></mxGeometry>
        </mxCell>

        <mxCell id="conn9" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#0d47a1;strokeWidth=4;endArrow=classic;endFill=1" edge="1" parent="1" source="parser-box" target="contable-box">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="label9" value="Parsed Records (Bulk Insert)" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=12;fontColor=#0d47a1;fontStyle=1;backgroundColor=#ffffff;labelBackgroundColor=#ffffff;labelBorderColor=#0d47a1" vertex="1" connectable="0" parent="conn9">
          <mxGeometry x="-0.2" y="2" relative="1" as="geometry"><mxPoint x="2" y="-12" as="offset" /></mxGeometry>
        </mxCell>

        <mxCell id="conn10" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#0d47a1;strokeWidth=4;endArrow=classic;endFill=1" edge="1" parent="1" source="contable-box" target="validacion-box">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="label10" value="Trigger Validation (37 validators)" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=12;fontColor=#0d47a1;fontStyle=1;backgroundColor=#ffffff;labelBackgroundColor=#ffffff;labelBorderColor=#0d47a1" vertex="1" connectable="0" parent="conn10">
          <mxGeometry x="-0.2" y="2" relative="1" as="geometry"><mxPoint x="2" y="-12" as="offset" /></mxGeometry>
        </mxCell>

        <!-- ValidaciÃ³n â†’ Correcciones -->
        <mxCell id="conn11" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#c62828;strokeWidth=3;endArrow=classic;endFill=1;dashed=1" edge="1" parent="1" source="validacion-box" target="correccion-manual-box">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="label11" value="ERROR" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=12;fontColor=#c62828;fontStyle=1;backgroundColor=#ffffff;labelBackgroundColor=#ffffff;labelBorderColor=#c62828" vertex="1" connectable="0" parent="conn11">
          <mxGeometry x="-0.2" y="2" relative="1" as="geometry"><mxPoint x="2" y="-10" as="offset" /></mxGeometry>
        </mxCell>

        <mxCell id="conn12" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#c62828;strokeWidth=3;endArrow=classic;endFill=1;dashed=1" edge="1" parent="1" source="validacion-box" target="correccion-raiz-box">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="label12" value="ERROR" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=12;fontColor=#c62828;fontStyle=1;backgroundColor=#ffffff;labelBackgroundColor=#ffffff;labelBorderColor=#c62828" vertex="1" connectable="0" parent="conn12">
          <mxGeometry x="-0.2" y="2" relative="1" as="geometry"><mxPoint x="2" y="-10" as="offset" /></mxGeometry>
        </mxCell>

        <!-- ValidaciÃ³n â†’ SFTP Gateway -->
        <mxCell id="conn13" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#2e7d32;strokeWidth=5;endArrow=classic;endFill=1" edge="1" parent="1" source="validacion-box" target="sftp-gateway-box">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="label13" value="VALIDATION OK (37/37 passed)" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=13;fontColor=#2e7d32;fontStyle=1;backgroundColor=#ffffff;labelBackgroundColor=#ffffff;labelBorderColor=#2e7d32" vertex="1" connectable="0" parent="conn13">
          <mxGeometry x="-0.2" y="2" relative="1" as="geometry"><mxPoint x="2" y="-12" as="offset" /></mxGeometry>
        </mxCell>

        <!-- SFTP Gateway â†’ CONSAR -->
        <mxCell id="conn14" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#2e7d32;strokeWidth=6;endArrow=classic;endFill=1" edge="1" parent="1" source="sftp-gateway-box" target="consar-box">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="label14" value="SFTP + TLS 1.3 | PGP Encrypted File" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=14;fontColor=#1b5e20;fontStyle=1;backgroundColor=#c8e6c9;labelBackgroundColor=#c8e6c9;labelBorderColor=#2e7d32" vertex="1" connectable="0" parent="conn14">
          <mxGeometry x="-0.2" y="2" relative="1" as="geometry"><mxPoint x="2" y="-15" as="offset" /></mxGeometry>
        </mxCell>

        <!-- ValidaciÃ³n â†’ Reports -->
        <mxCell id="conn15" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#0d47a1;strokeWidth=2;endArrow=classic;endFill=1;dashed=1" edge="1" parent="1" source="validacion-box" target="reports-box">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- Reports â†’ Notifications -->
        <mxCell id="conn16" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#0d47a1;strokeWidth=2;endArrow=classic;endFill=1" edge="1" parent="1" source="reports-box" target="notifications-box">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- Loop back: CorrecciÃ³n RaÃ­z â†’ ETL -->
        <mxCell id="conn17" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#c62828;strokeWidth=3;endArrow=classic;endFill=1;dashed=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0" edge="1" parent="1" source="correccion-raiz-box" target="etl-box">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="60" y="1450" />
              <mxPoint x="60" y="970" />
              <mxPoint x="770" y="970" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="label17" value="Re-extract from source" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=11;fontColor=#c62828;fontStyle=1;backgroundColor=#ffffff;labelBackgroundColor=#ffffff;labelBorderColor=#c62828" vertex="1" connectable="0" parent="conn17">
          <mxGeometry x="-0.8" y="2" relative="1" as="geometry"><mxPoint x="-40" y="-10" as="offset" /></mxGeometry>
        </mxCell>

        <!-- ========== LEYENDA ========== -->
        <mxCell id="leyenda-bg" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#424242;strokeWidth=2" vertex="1" parent="1">
          <mxGeometry x="80" y="1950" width="1200" height="380" as="geometry" />
        </mxCell>

        <mxCell id="leyenda-titulo" value="LEYENDA Y NOTAS TÃ‰CNICAS" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=20;fontStyle=1;fontColor=#212121" vertex="1" parent="1">
          <mxGeometry x="110" y="1970" width="400" height="30" as="geometry" />
        </mxCell>

        <mxCell id="leyenda-colores" value="&lt;b style=&quot;font-size:14px&quot;&gt;COLORES DE COMPONENTES:&lt;/b&gt;&#xa;â–  Verde: Sistemas externos (origen/destino)&#xa;â–  Negro: Aladdin (BlackRock)&#xa;â–  Azul claro: Portal web / Usuarios&#xa;â–  Morado: Seguridad (API Gateway, Auth, Secrets)&#xa;â–  Amarillo: MensajerÃ­a (Service Bus, SQS)&#xa;â–  Azul oscuro: Core Hergon (Parser, Contable, ValidaciÃ³n, SFTP Gateway)&#xa;â–  Rojo: CorrecciÃ³n (Manual / RaÃ­z)&#xa;â–  Gris: Data Layer&#xa;&#xa;&lt;b style=&quot;font-size:14px&quot;&gt;TIPOS DE CONEXIÃ“N:&lt;/b&gt;&#xa;â”â”â”â”  Flujo principal (lÃ­nea sÃ³lida gruesa)&#xa;- - - -  Flujo secundario / eventos (lÃ­nea punteada)" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=12;fontColor=#424242" vertex="1" parent="1">
          <mxGeometry x="110" y="2010" width="550" height="300" as="geometry" />
        </mxCell>

        <mxCell id="leyenda-protocolos" value="&lt;b style=&quot;font-size:14px&quot;&gt;PROTOCOLOS:&lt;/b&gt;&#xa;â€¢ REST API + OAuth 2.0 (Aladdin, APIs)&#xa;â€¢ RFC/BAPI (SAP)&#xa;â€¢ DB Link/OData (Oracle)&#xa;â€¢ SFTP + TLS 1.3 (CONSAR, transfers)&#xa;â€¢ PGP Encryption (CONSAR)&#xa;&#xa;&lt;b style=&quot;font-size:14px&quot;&gt;âš ï¸ CRÃTICOS:&lt;/b&gt;&#xa;1. &lt;b&gt;ETL/Integration Service:&lt;/b&gt; ExtracciÃ³n&#xa;   automatizada desde sistemas corporativos&#xa;2. &lt;b&gt;37 Validaciones:&lt;/b&gt; EjecuciÃ³n en paralelo&#xa;3. &lt;b&gt;SFTP + PGP:&lt;/b&gt; Requerimiento CONSAR&#xa;4. &lt;b&gt;Event Sourcing:&lt;/b&gt; AuditorÃ­a 7 aÃ±os&#xa;5. &lt;b&gt;Multi-tenancy:&lt;/b&gt; Row-Level Security&#xa;6. &lt;b&gt;Secrets Management:&lt;/b&gt; Auto-rotation" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=12;fontColor=#424242" vertex="1" parent="1">
          <mxGeometry x="690" y="2010" width="560" height="300" as="geometry" />
        </mxCell>

        <!-- ========== NOTAS IMPORTANTES ========== -->
        <mxCell id="notas-bg" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff3e0;strokeColor=#ef6c00;strokeWidth=2" vertex="1" parent="1">
          <mxGeometry x="1320" y="1950" width="1400" height="380" as="geometry" />
        </mxCell>

        <mxCell id="notas-titulo" value="âš ï¸ NOTAS TÃ‰CNICAS IMPORTANTES" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=20;fontStyle=1;fontColor=#e65100" vertex="1" parent="1">
          <mxGeometry x="1350" y="1970" width="500" height="30" as="geometry" />
        </mxCell>

        <mxCell id="notas-texto" value="&lt;b style=&quot;font-size:13px&quot;&gt;1. ETL / INTEGRATION SERVICE:&lt;/b&gt; Componente crÃ­tico para extracciÃ³n automatizada desde SAP, Oracle, Aladdin.&#xa;   Implementar con .NET 8 Worker Service + Azure Data Factory o AWS Glue. Sin este componente no hay automatizaciÃ³n.&#xa;&#xa;&lt;b style=&quot;font-size:13px&quot;&gt;2. 37 VALIDACIONES CONSAR:&lt;/b&gt; Azure Functions (10 Premium always-on + 27 Consumption) o Lambda (Graviton4).&#xa;   EjecuciÃ³n paralela para mÃ¡xima performance. Ver catÃ¡logo: docs/Catalogo Scripts Validaciones.csv&#xa;&#xa;&lt;b style=&quot;font-size:13px&quot;&gt;3. SFTP + PGP OBLIGATORIO:&lt;/b&gt; Requerimiento regulatorio CONSAR. Archivo debe encriptarse con clave pÃºblica CONSAR.&#xa;   Implementar con Azure FTP Service o AWS Transfer Family. Sin esto no se puede enviar a CONSAR.&#xa;&#xa;&lt;b style=&quot;font-size:13px&quot;&gt;4. EVENT SOURCING:&lt;/b&gt; Todos los eventos en Event Store (Cosmos DB/DynamoDB) con retenciÃ³n 7 aÃ±os (auditorÃ­a CONSAR).&#xa;   PatrÃ³n append-only, immutable. CrÃ­tico para compliance.&#xa;&#xa;&lt;b style=&quot;font-size:13px&quot;&gt;5. MULTI-TENANCY:&lt;/b&gt; Row-Level Security (RLS) en SQL para aislar datos por AFORE. Cada request incluye aforeId en JWT.&#xa;&#xa;&lt;b style=&quot;font-size:13px&quot;&gt;6. SECRETS MANAGEMENT:&lt;/b&gt; Azure Key Vault / AWS Secrets Manager para: API Keys (Aladdin), certificados PGP&#xa;   (CONSAR), credenciales DB, certificados SSL. Auto-rotation cada 90 dÃ­as.&#xa;&#xa;&lt;b style=&quot;font-size:13px&quot;&gt;7. CORRECCIÃ“N DE RAÃZ vs MANUAL:&lt;/b&gt; Si error en sistema origen â†’ CorrecciÃ³n de RaÃ­z â†’ Re-extracciÃ³n automÃ¡tica.&#xa;   Si error de formato/mapeo â†’ CorrecciÃ³n Manual en portal web.&#xa;&#xa;&lt;b style=&quot;font-size:13px&quot;&gt;8. ESCALABILIDAD:&lt;/b&gt; Auto-scaling: Container Apps/ECS (1-10 replicas), Functions/Lambda (0-500 concurrent),&#xa;   SQL (4-16 vCore), Cosmos/DynamoDB (1000-10000 RU/s)." style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=11;fontColor=#bf360c" vertex="1" parent="1">
          <mxGeometry x="1350" y="2015" width="1340" height="300" as="geometry" />
        </mxCell>

      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
